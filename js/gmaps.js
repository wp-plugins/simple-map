/*
 * GMaps.js 0.1.12.1
 * http://hpneo.github.com/gmaps/
 *
 * Copyright 2012, Gustavo Leon
 * Released under the MIT License.
 */
var GMaps=(function(b){var a=function(m){var l=this;var j="position:absolute;display:none;min-width:100px;background:white;list-style:none;padding:8px;box-shadow:2px 2px 6px #ccc";window.context_menu={};this.div=b(m.div)[0];this.controls=[];this.overlays=[];this.layers=[];this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.infoWindow=null;this.overlay_div=null;this.zoom=m.zoom||15;var g;if(m.mapType){g=google.maps.MapTypeId[m.mapType.toUpperCase()]}else{g=google.maps.MapTypeId.ROADMAP}var d=new google.maps.LatLng(m.lat,m.lng);delete m.lat;delete m.lng;delete m.mapType;var f={zoom:this.zoom,center:d,mapTypeId:g};var k=b.extend(f,m);this.map=new google.maps.Map(this.div,k);var h=function(p,t){var s="";var v=window.context_menu[p];for(var q in v){if(v.hasOwnProperty(q)){var r=v[q];s+='<li><a id="'+p+"_"+q+'" href="#">'+r.title+"</a></li>"}}var o=b("#gmaps_context_menu");o.html(s);o.undelegate();o.delegate("li a","click",function(w){w.preventDefault();v[b(this).attr("id").replace(p+"_","")].action.call(l,t);l.hideContextMenu()});var n=b(l.div).offset().left+t.pixel.x-15;var u=b(l.div).offset().top+t.pixel.y-15;o.css({left:n,top:u}).fadeIn(200)};var i=function(p,o){if(p==="marker"){o.pixel={};var n=new google.maps.OverlayView();n.setMap(l.map);n.draw=function(){var r=n.getProjection();var q=o.marker.getPosition();o.pixel=r.fromLatLngToContainerPixel(q);h(p,o)}}else{h(p,o)}};this.setContextMenu=function(n){window.context_menu[n.control]={};var p='<ul id="gmaps_context_menu" style="'+j+'"></ul>';for(var o in n.options){if(n.options.hasOwnProperty(o)){var q=n.options[o];window.context_menu[n.control][q.name]={title:q.title,action:q.action}}}b("body").append(p);b("#gmaps_context_menu").mouseleave(function(){b(this).delay(100).fadeOut(200)})};this.hideContextMenu=function(){b("#gmaps_context_menu").fadeOut(200)};google.maps.event.addListener(this.map,"bounds_changed",function(n){if(m.bounds_changed){m.bounds_changed(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"center_changed",function(n){if(m.center_changed){m.center_changed(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"click",function(n){if(m.click){m.click(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"dblclick",function(n){if(m.dblclick){m.dblclick(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"drag",function(n){if(m.drag){m.drag(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"dragend",function(n){if(m.dragend){m.dragend(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"dragstart",function(n){if(m.dragstart){m.dragstart(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"idle",function(n){if(m.idle){m.idle(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"maptypeid_changed",function(n){if(m.maptypeid_changed){m.maptypeid_changed(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"mousemove",function(n){if(m.mousemove){m.mousemove(n)}});google.maps.event.addListener(this.map,"mouseout",function(n){if(m.mouseout){m.mouseout(n)}});google.maps.event.addListener(this.map,"mouseover",function(n){if(m.mouseover){m.mouseover(n)}});google.maps.event.addListener(this.map,"projection_changed",function(n){if(m.projection_changed){m.projection_changed(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"resize",function(n){if(m.resize){m.resize(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"rightclick",function(n){if(m.rightclick){m.rightclick(n)}i("map",n)});google.maps.event.addListener(this.map,"tilesloaded",function(n){if(m.tilesloaded){m.tilesloaded(n)}l.hideContextMenu()});google.maps.event.addListener(this.map,"zoom_changed",function(n){if(m.zoom_changed){m.zoom_changed(n)}l.hideContextMenu()});this.setCenter=function(o,n,p){this.map.panTo(new google.maps.LatLng(o,n));if(p){p()}};this.getCenter=function(){return this.map.getCenter()};this.getDiv=function(){return this.div};this.setZoom=function(n){this.map.setZoom(n)};this.zoomIn=function(n){this.map.setZoom(this.map.getZoom()+n)};this.zoomOut=function(n){this.map.setZoom(this.map.getZoom()-n)};this.createControl=function(o){o.style.cursor="pointer";o.style.fontFamily="Arial, sans-serif";o.style.fontSize="13px";o.style.boxShadow="rgba(0, 0, 0, 0.398438) 0px 2px 4px";var n=b("<div></div>");n.css(o.style);n.text(o.text);var q=n[0];for(var p in o.events){google.maps.event.addDomListener(q,p,function(){o.events[p].apply(this,[this])})}q.index=1;return q};this.addControl=function(o){var n=google.maps.ControlPosition[o.position.toUpperCase()];delete o.position;var p=this.createControl(o);this.controls.push(p);this.map.controls[n].push(p);return p};this.createMarker=function(r){if(r.lat&&r.lng){var p=this;var s=r.details;var u=r.fences;var t=r.outside;var q={position:new google.maps.LatLng(r.lat,r.lng),map:null};delete r.lat;delete r.lng;delete r.fences;delete r.outside;var o=b.extend(q,r);var n=new google.maps.Marker(o);n.fences=u;if(r.infoWindow){n.infoWindow=new google.maps.InfoWindow(r.infoWindow);if(r.infoWindow.closeclick){google.maps.event.addListener(n.infoWindow,"closeclick",function(){r.infoWindow.closeclick()})}if(r.infoWindow.content_changed){google.maps.event.addListener(n.infoWindow,"content_changed",function(){r.infoWindow.content_changed()})}if(r.infoWindow.domready){google.maps.event.addListener(n.infoWindow,"domready",function(){r.infoWindow.domready()})}if(r.infoWindow.position_changed){google.maps.event.addListener(n.infoWindow,"position_changed",function(){r.infoWindow.position_changed()})}if(r.infoWindow.zindex_changed){google.maps.event.addListener(n.infoWindow,"zindex_changed",function(){r.infoWindow.zindex_changed()})}}google.maps.event.addListener(n,"click",function(){this.details=s;if(r.click){r.click.apply(this,[this])}if(n.infoWindow){p.hideInfoWindows();n.infoWindow.open(p.map,n)}});if(r.drag){google.maps.event.addListener(n,"drag",function(){r.drag(this)})}if(r.dragend||n.fences){google.maps.event.addListener(n,"dragend",function(){if(r.dragend){r.dragend(this)}if(n.fences){p.checkMarkerGeofence(n,function(v,w){t(v,w)})}})}if(r.dragstart){google.maps.event.addListener(n,"dragstart",function(){r.dragstart(this)})}if(r.mouseout){google.maps.event.addListener(n,"mouseout",function(){r.mouseout(this)})}if(r.mouseover){google.maps.event.addListener(n,"mouseover",function(){r.mouseover(this)})}if(r.mouseup){google.maps.event.addListener(n,"mouseup",function(){r.mouseup(this)})}if(r.position_changed){google.maps.event.addListener(n,"position_changed",function(){r.position_changed(this)})}return n}else{throw"No latitude or longitude defined"}};this.addMarker=function(o){if(o.lat&&o.lng){var n=this.createMarker(o);n.setMap(this.map);this.markers.push(n);return n}else{throw"No latitude or longitude defined"}};this.addMarkers=function(p){for(var o=0,n;n=p[o];o++){this.addMarker(n)}return this.markers};this.hideInfoWindows=function(){for(var o=0,n;n=this.markers[o];o++){if(n.infoWindow){n.infoWindow.close()}}};this.removeMarkers=function(){for(var o=0,n;n=this.markers[o];o++){n.setMap(null)}this.markers=[]};this.drawOverlay=function(o){var n=new google.maps.OverlayView();n.setMap(l.map);n.onAdd=function(){var r=document.createElement("div");r.style.borderStyle="none";r.style.borderWidth="0px";r.style.position="absolute";r.innerHTML=o.content;l.overlay_div=r;var q=this.getPanes();if(!o.layer){o.layer="overlayLayer"}var p=q[o.layer];p.appendChild(r)};n.draw=function(){var p=this.getProjection();var q=p.fromLatLngToDivPixel(new google.maps.LatLng(o.lat,o.lng));o.horizontalOffset=o.horizontalOffset||0;o.verticalOffset=o.verticalOffset||0;var s=l.overlay_div;var r=s.children;switch(o.verticalAlign){case"top":s.style.top=(q.y-b(r).height()+o.verticalOffset)+"px";break;default:case"middle":s.style.top=(q.y-(b(r).height()/2)+o.verticalOffset)+"px";break;case"bottom":s.style.top=(q.y+o.verticalOffset)+"px";break}switch(o.horizontalAlign){case"left":s.style.left=(q.x-b(r).width()+o.horizontalOffset)+"px";break;default:case"center":s.style.left=(q.x-(b(r).width()/2)+o.horizontalOffset)+"px";break;case"right":s.style.left=(q.x+o.horizontalOffset)+"px";break}};n.onRemove=function(){l.overlay_div.parentNode.removeChild(l.overlay_div);l.overlay_div=null};l.overlays.push(n);return n};this.removeOverlay=function(n){n.setMap(null)};this.removeOverlays=function(){for(var n=0,o;o=l.overlays[n];n++){o.setMap(null)}l.overlays=[]};this.drawPolyline=function(o){var r=[];var q=o.path;if(q.length){if(q[0][0]===undefined){r=q}else{for(var p=0,s;s=q[p];p++){r.push(new google.maps.LatLng(s[0],s[1]))}}}var n=new google.maps.Polyline({map:this.map,path:r,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight});if(o.click){google.maps.event.addListener(n,"click",function(t){o.click(t)})}if(o.dblclick){google.maps.event.addListener(n,"dblclick",function(t){o.dblclick(t)})}if(o.mousedown){google.maps.event.addListener(n,"mousedown",function(t){o.mousedown(t)})}if(o.mousemove){google.maps.event.addListener(n,"mousemove",function(t){o.mousemove(t)})}if(o.mouseout){google.maps.event.addListener(n,"mouseout",function(t){o.mouseout(t)})}if(o.mouseover){google.maps.event.addListener(n,"mouseover",function(t){o.mouseover(t)})}if(o.mouseup){google.maps.event.addListener(n,"mouseup",function(t){o.mouseup(t)})}if(o.rightclick){google.maps.event.addListener(n,"rightclick",function(t){o.rightclick(t)})}this.polylines.push(n);return n};this.drawCircle=function(n){n=b.extend({map:this.map,center:new google.maps.LatLng(n.lat,n.lng)},n);delete n.lat;delete n.lng;var o=new google.maps.Circle(n);google.maps.event.addListener(o,"click",function(p){if(n.click){n.click(p)}});google.maps.event.addListener(o,"dblclick",function(p){if(n.dblclick){n.dblclick(p)}});google.maps.event.addListener(o,"mousedown",function(p){if(n.mousedown){n.mousedown(p)}});google.maps.event.addListener(o,"mousemove",function(p){if(n.mousemove){n.mousemove(p)}});google.maps.event.addListener(o,"mouseout",function(p){if(n.mouseout){n.mouseout(p)}});google.maps.event.addListener(o,"mouseover",function(p){if(n.mouseover){n.mouseover(p)}});google.maps.event.addListener(o,"mouseup",function(p){if(n.mouseup){n.mouseup(p)}});google.maps.event.addListener(o,"rightclick",function(p){if(n.rightclick){n.rightclick(p)}});return o};this.drawPolygon=function(n){n=b.extend({map:this.map},n);var o=new google.maps.Polygon(n);google.maps.event.addListener(o,"click",function(p){if(n.click){n.click(p)}});google.maps.event.addListener(o,"dblclick",function(p){if(n.dblclick){n.dblclick(p)}});google.maps.event.addListener(o,"mousedown",function(p){if(n.mousedown){n.mousedown(p)}});google.maps.event.addListener(o,"mousemove",function(p){if(n.mousemove){n.mousemove(p)}});google.maps.event.addListener(o,"mouseout",function(p){if(n.mouseout){n.mouseout(p)}});google.maps.event.addListener(o,"mouseover",function(p){if(n.mouseover){n.mouseover(p)}});google.maps.event.addListener(o,"mouseup",function(p){if(n.mouseup){n.mouseup(p)}});google.maps.event.addListener(o,"rightclick",function(p){if(n.rightclick){n.rightclick(p)}});this.polygons.push(o);return o};this.getFromFusionTables=function(o){var q=o.events;delete o.events;var n=o;var p=new google.maps.FusionTablesLayer(n);for(var r in q){google.maps.event.addListener(p,r,function(s){q[r].apply(this,[s])})}this.layers.push(p);return p};this.loadFromFusionTables=function(n){var o=this.getFromFusionTables(n);o.setMap(this.map);return o};this.getFromKML=function(o){var n=o.url;var q=o.events;delete o.url;delete o.events;var s=o;var p=new google.maps.KmlLayer(n,s);for(var r in q){google.maps.event.addListener(p,r,function(t){q[r].apply(this,[t])})}this.layers.push(p);return p};this.loadFromKML=function(n){var o=this.getFromKML(n);o.setMap(this.map);return o};var c,e;this.getRoutes=function(r){switch(r.travelMode){case"bicycling":c=google.maps.TravelMode.BICYCLING;break;case"driving":c=google.maps.TravelMode.DRIVING;break;default:c=google.maps.TravelMode.WALKING;break}if(r.unitSystem==="imperial"){e=google.maps.UnitSystem.IMPERIAL}else{e=google.maps.UnitSystem.METRIC}var q={avoidHighways:true,avoidTolls:true,optimizeWaypoints:true,waypoints:[]};var p=b.extend(q,r);p.origin=new google.maps.LatLng(r.origin[0],r.origin[1]);p.destination=new google.maps.LatLng(r.destination[0],r.destination[1]);p.travelMode=c;p.unitSystem=e;delete p.callback;var o=this;var n=new google.maps.DirectionsService();n.route(p,function(s,t){if(t===google.maps.DirectionsStatus.OK){for(var u in s.routes){if(s.routes.hasOwnProperty(u)){o.routes.push(s.routes[u])}}}if(r.callback){r.callback(o.routes)}})};this.drawRoute=function(o){var n=this;this.getRoutes({origin:o.origin,destination:o.destination,travelMode:o.travelMode,callback:function(p){if(p.length>0){n.drawPolyline({path:p[p.length-1].overview_path,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight});if(o.callback){o.callback(p[p.length-1])}}}})};this.travelRoute=function(o){if(o.origin&&o.destination){this.getRoutes({origin:o.origin,destination:o.destination,travelMode:o.travelMode,callback:function(v){if(v.length>0&&o.step){var s=v[v.length-1];if(s.legs.length>0){var r=s.legs[0].steps;for(var t=0,u;u=r[t];t++){u.step_number=t;o.step(u)}}}}})}else{if(o.route){if(o.route.legs.length>0){var n=o.route.legs[0].steps;for(var p=0,q;q=n[p];p++){q.step_number=p;o.step(q)}}}}};this.drawSteppedRoute=function(o){if(o.origin&&o.destination){this.getRoutes({origin:o.origin,destination:o.destination,travelMode:o.travelMode,callback:function(v){if(v.length>0&&o.step){var s=v[v.length-1];if(s.legs.length>0){var r=s.legs[0].steps;for(var t=0,u;u=r[t];t++){u.step_number=t;l.drawPolyline({path:u.path,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight});o.step(u)}}}}})}else{if(o.route){if(o.route.legs.length>0){var n=o.route.legs[0].steps;for(var p=0,q;q=n[p];p++){q.step_number=p;l.drawPolyline({path:q.path,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeWeight:o.strokeWeight});o.step(q)}}}}};this.checkGeofence=function(o,n,p){return p.containsLatLng(new google.maps.LatLng(o,n))};this.checkMarkerGeofence=function(n,p){if(n.fences){for(var o=0,q;q=n.fences[o];o++){var r=n.getPosition();if(!l.checkGeofence(r.lat(),r.lng(),q)){p(n,q)}}}}};a.Route=function(c){this.map=c.map;this.route=c.route;this.step_count=0;this.steps=this.route.legs[0].steps;this.steps_length=this.steps.length;this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray(),strokeColor:c.strokeColor,strokeOpacity:c.strokeOpacity,strokeWeight:c.strokeWeight}).getPath();this.back=function(){if(this.step_count>0){this.step_count--;var e=this.route.legs[0].steps[this.step_count].path;for(var d in e){if(e.hasOwnProperty(d)){this.polyline.pop()}}}};this.forward=function(){if(this.step_count<this.steps_length){var e=this.route.legs[0].steps[this.step_count].path;for(var d in e){if(e.hasOwnProperty(d)){this.polyline.push(e[d])}}this.step_count++}}};a.geolocate=function(c){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(d){c.success(d);if(c.always){c.always()}},function(d){c.error(d);if(c.always){c.always()}},c.options)}else{c.not_supported();if(c.always){c.always()}}};a.geocode=function(c){this.geocoder=new google.maps.Geocoder();var d=c.callback;if(c.lat&&c.lng){c.latLng=new google.maps.LatLng(c.lat,c.lng)}delete c.lat;delete c.lng;delete c.callback;this.geocoder.geocode(c,function(f,e){d(f,e)})};a.staticMapURL=function(d){var g=[];var v;var e="http://maps.googleapis.com/maps/api/staticmap";if(d.url){e=d.url;delete d.url}e+="?";var t=d.markers;delete d.markers;if(!t&&d.marker){t=[d.marker];delete d.marker}var o=d.polyline;delete d.polyline;if(d.center){g.push("center="+d.center);delete d.center}else{if(d.address){g.push("center="+d.address);delete d.address}else{if(d.lat){g.push(["center=",d.lat,",",d.lng].join(""));delete d.lat;delete d.lng}else{if(d.visible){var c=encodeURI(d.visible.join("|"));g.push("visible="+c)}}}}var m=d.size;if(m){if(m.join){m=m.join("x")}delete d.size}else{m="630x300"}g.push("size="+m);if(!d.zoom){d.zoom=15}var u=d.hasOwnProperty("sensor")?!!d.sensor:true;delete d.sensor;g.push("sensor="+u);for(var h in d){if(d.hasOwnProperty(h)){g.push(h+"="+d[h])}}if(t){var k,l;for(var r=0;v=t[r];r++){k=[];if(v.size&&v.size!=="normal"){k.push("size:"+v.size)}else{if(v.icon){k.push("icon:"+encodeURI(v.icon))}}if(v.color){k.push("color:"+v.color.replace("#","0x"))}if(v.label){k.push("label:"+v.label[0].toUpperCase())}l=(v.address?v.address:v.lat+","+v.lng);if(k.length||r===0){k.push(l);k=k.join("|");g.push("markers="+encodeURI(k))}else{k=g.pop()+encodeURI("|"+l);g.push(k)}}}function s(i,j){if(i[0]==="#"){i=i.replace("#","0x");if(j){j=parseFloat(j);j=Math.min(1,Math.max(j,0));if(j===0){return"0x00000000"}j=(j*255).toString(16);if(j.length===1){j+=j}i=i.slice(0,8)+j}}return i}if(o){v=o;o=[];if(v.strokeWeight){o.push("weight:"+parseInt(v.strokeWeight,10))}if(v.strokeColor){var p=s(v.strokeColor,v.strokeOpacity);o.push("color:"+p)}if(v.fillColor){var w=s(v.fillColor,v.fillOpacity);o.push("fillcolor:"+w)}var n=v.path;if(n.join){for(var q=0,f;f=n[q];q++){o.push(f.join(","))}}else{o.push("enc:"+n)}o=o.join("|");g.push("path="+encodeURI(o))}g=g.join("&");return e+g};if(!google.maps.Polygon.prototype.getBounds){google.maps.Polygon.prototype.getBounds=function(e){var d=new google.maps.LatLngBounds();var h=this.getPaths();var g;for(var f=0;f<h.getLength();f++){g=h.getAt(f);for(var c=0;c<g.getLength();c++){d.extend(g.getAt(c))}}return d}}google.maps.Polygon.prototype.containsLatLng=function(g){var c=this.getBounds();if(c!==null&&!c.contains(g)){return false}var e=false;var d=this.getPaths().getLength();for(var f=0;f<d;f++){var o=this.getPaths().getAt(f);var l=o.getLength();var h=l-1;for(var k=0;k<l;k++){var n=o.getAt(k);var m=o.getAt(h);if(n.lng()<g.lng()&&m.lng()>=g.lng()||m.lng()<g.lng()&&n.lng()>=g.lng()){if(n.lat()+(g.lng()-n.lng())/(m.lng()-n.lng())*(m.lat()-n.lat())<g.lat()){e=!e}}h=k}}return e};google.maps.LatLngBounds.prototype.containsLatLng=function(c){return this.contains(c)};google.maps.Marker.prototype.setFences=function(c){this.fences=c};google.maps.Marker.prototype.addFence=function(c){this.fences.push(c)};return a}(jQuery));
